import React$1, { PureComponent } from 'react';
import { FeaturesContext } from '../../utilities/features/context.ts.esnext';
import { classNames } from '../../utilities/css.ts.esnext';
import { Button as Button$1 } from '../Button/Button.tsx.esnext';
import { ButtonGroup as ButtonGroup$1 } from '../ButtonGroup/ButtonGroup.tsx.esnext';
import { sortAndOverrideActionOrder } from './utilities.ts.esnext';
import { MenuAction as MenuAction$1 } from './components/MenuAction/MenuAction.tsx.esnext';
import { MenuGroup as MenuGroup$1 } from './components/MenuGroup/MenuGroup.tsx.esnext';
import { RollupActions as RollupActions$1 } from './components/RollupActions/RollupActions.tsx.esnext';
import styles from './ActionMenu.scss.esnext';

class ActionMenu extends PureComponent {
  constructor(...args) {
    super(...args);
    this.context = void 0;
    this.state = {
      activeMenuGroup: undefined
    };

    this.renderActions = () => {
      const {
        newDesignLanguage
      } = this.context || {};
      const {
        actions = [],
        groups = []
      } = this.props;
      const {
        activeMenuGroup
      } = this.state;
      const menuActions = [...actions, ...groups];
      const overriddenActions = sortAndOverrideActionOrder(menuActions);
      const actionMarkup = overriddenActions.map((action, index) => {
        if ('title' in action) {
          const {
            title,
            actions,
            ...rest
          } = action;
          return actions.length > 0 ? /*#__PURE__*/React$1.createElement(MenuGroup$1, Object.assign({
            key: `MenuGroup-${index}`,
            title: title,
            active: title === activeMenuGroup,
            actions: actions
          }, rest, {
            onOpen: this.handleMenuGroupToggle,
            onClose: this.handleMenuGroupClose
          })) : null;
        }

        const {
          content,
          onAction,
          ...rest
        } = action;
        return newDesignLanguage ? /*#__PURE__*/React$1.createElement(Button$1, Object.assign({
          key: index,
          onClick: onAction
        }, rest), content) : /*#__PURE__*/React$1.createElement(MenuAction$1, Object.assign({
          key: `MenuAction-${index}`,
          content: content,
          onAction: onAction
        }, rest));
      });
      return /*#__PURE__*/React$1.createElement("div", {
        className: styles.ActionsLayout
      }, newDesignLanguage ? /*#__PURE__*/React$1.createElement(ButtonGroup$1, null, actionMarkup) : actionMarkup);
    };

    this.handleMenuGroupToggle = group => {
      this.setState(({
        activeMenuGroup
      }) => ({
        activeMenuGroup: activeMenuGroup ? undefined : group
      }));
    };

    this.handleMenuGroupClose = () => {
      this.setState({
        activeMenuGroup: undefined
      });
    };
  }

  render() {
    const {
      actions = [],
      groups = [],
      rollup
    } = this.props;

    if (actions.length === 0 && groups.length === 0) {
      return null;
    }

    const actionMenuClassNames = classNames(styles.ActionMenu, rollup && styles.rollup);
    const rollupSections = groups.map(group => convertGroupToSection(group));
    return /*#__PURE__*/React$1.createElement("div", {
      className: actionMenuClassNames
    }, rollup ? /*#__PURE__*/React$1.createElement(RollupActions$1, {
      items: actions,
      sections: rollupSections
    }) : this.renderActions());
  } // eslint-disable-next-line @shopify/react-no-multiple-render-methods


}
ActionMenu.contextType = FeaturesContext;
function hasGroupsWithActions(groups = []) {
  return groups.length === 0 ? false : groups.some(group => group.actions.length > 0);
}

function convertGroupToSection({
  title,
  actions
}) {
  return {
    title,
    items: actions
  };
}

export { ActionMenu, hasGroupsWithActions };
